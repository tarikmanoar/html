<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>
        How to Force Eager Loading and Prevent N+1 I... | Ash Allen Design
    </title>
    <meta name="description" content="Learn how to force eager loading and prevent lazy loading in your Laravel application. You can use this feature to prevent N+1 queries to gain a performance improvement.">
    <link rel="canonical" href="how-to-force-eager-loading-and-prevent-n-1-issues-in-laravel">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-token" content="WOddtz2xrsMLwDq1Y00hyUG0vtUNByspVCaLQ9k9">

    <!-- Open Graph Tags -->
    <meta property="og:title" content="How to Force Eager Loading and Prevent N+1 Issues in Laravel"/>
    <meta property="og:url" content="https://ashallendesign.co.uk/blog/how-to-force-eager-loading-and-prevent-n-1-issues-in-laravel"/>
    <meta property="og:type" content="website"/>
    <meta property="og:description" content="Learn how to force eager loading and prevent lazy loading in your Laravel application. You can use this feature to prevent N+1 queries to gain a performance improvement."/>
    <meta property="og:image" content="https://ashallendesign.ams3.digitaloceanspaces.com/public/blog/20/how-to-force-eager-loading-and-prevent-n-1-issues-in-laravel.png"/>

    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Poppins:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <link rel='preload' as="font" href="../fonts/ElegantIcons.woff" type="font/woff" crossorigin>

    <!-- CSS - Vendor CSS -->
    <link href="../css/vendor.css?id=d1939467ce73c95e2c3f" rel="stylesheet">

    <!-- jQuery -->
    <script defer src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- Font Awesome -->
    <script defer src="https://kit.fontawesome.com/210fec59d6.js" crossorigin="anonymous"></script>

    <!-- Cookie Consent -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>

    <!-- Scripts -->
    <script defer type="text/javascript" src="../js/scripts.js?id=bd890df8d5745390bb89"></script>

            <!-- Fathom - beautiful, simple website analytics -->
        <script src="https://cdn.usefathom.com/script.js" data-site="WXKBGHKV" defer></script>
    
</head>
<body data-spy="scroll" data-target=".navbar">
<header class="header">
    <nav class="navbar navbar-expand-lg fixed-top" id="main-nav">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <img class="white-logo" src="../images/custom/logo-white-side.png?v=1" alt="Ash Allen Design logo in white">
                <img class="color-logo" src="../images/custom/logo-colour-side.png?v=1" alt="Ash Allen Design in colour">
            </a>
            <button class="navbar-toggler order-1" type="button" data-toggle="collapse" data-target="#main-nav-collapse" aria-controls="main-nav-collapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="menu-toggle">
                    <span class="hamburger">
                        <span></span>
                        <span></span>
                        <span></span>
                    </span>
                    <span class="hamburger-cross">
                        <span></span>
                        <span></span>
                    </span>
                </span>
            </button>
            <div class="collapse navbar-collapse order-3 order-lg-2" id="main-nav-collapse">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link nav-link-scroll" href="../index.html">Home</a>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="how-to-force-eager-loading-and-prevent-n-1-issues-in-laravel#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Services
                        </a>
                        <ul class="dropdown-menu">
                            <li class="nav-item"><a class="nav-link" href="../services">Services</a></li>
                            <hr>
                            <li class="nav-item"><a class="nav-link" href="../services/website-design">Website Design</a></li>
                            <li class="nav-item"><a class="nav-link" href="../services/laravel-web-development">Laravel Web Development</a></li>
                        </ul>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link nav-link-scroll" href="../freebies">Freebies</a>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="../portfolio" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Portfolio
                        </a>
                        <ul class="dropdown-menu">
                            <li class="nav-item"><a class="nav-link" href="../portfolio">Portfolio</a></li>
                            <hr>
                            <li class="nav-item"><a class="nav-link" href="../portfolio#about-me">About Me</a></li>
                            <li class="nav-item"><a class="nav-link" href="../portfolio#previous-projects">Previous Projects</a></li>
                        </ul>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link nav-link-scroll" href="../blog">Blog</a>
                    </li>

                    <div class="nav-button order-2 order-lg-3">
                        <a href="../contact">Contact</a>
                    </div>
                </ul>
            </div>
        </div>
        <div id="progress-bar"></div>
    </nav>
</header><!-- header -->


    <div class="page-title blog-page-title bg-img bg-6 overflow-x-hidden">
    <div class="overlay"></div>
    <div class="container">
        <div class="row mb-5">
            <div class="col-lg-7">
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-content align-items-center text-left">
                            <h1 class="page-name">
                                How to Force Eager Loading and Prevent N+1 Issues in Laravel
                            </h1>
                        </div>

                        <div class="col-lg-8 text-white py-5 px-lg-0">
                                                            <div class="mb-5">
                                                                                                                <a href="../blog?category=laravel" class="badge badge-secondary px-3 py-2 my-1 category-badge">
                                            <i class="fas fa-hashtag pr-2"></i>Laravel
                                        </a>
                                                                            <a href="../blog?category=tips-and-tricks" class="badge badge-secondary px-3 py-2 my-1 category-badge">
                                            <i class="fas fa-hashtag pr-2"></i>Tips &amp; Tricks
                                        </a>
                                                                            <a href="../blog?category=web-development" class="badge badge-secondary px-3 py-2 my-1 category-badge">
                                            <i class="fas fa-hashtag pr-2"></i>Web Development
                                        </a>
                                                                    </div>
                            
                            <div class="mb-5">
                                <i class="fa fa-clock pr-2"></i> 4 minutes read
                            </div>

                            <img src="../images/custom/AshleyAllen-Blog.png?v=1" alt="Ashley Allen - Freelance web developer"
                                 class="blog-author-image mr-2 shadow">
                            <span class="meta-author text-black">Ashley Allen</span>&nbsp;Â·&nbsp;
                            <span class="meta-date font-italic">21st May 2021</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-5 px-lg-0">
                <figure class="pb-3">
                    <img class="rounded-thumbnail img-fluid shadow"
                         src="https://ashallendesign.ams3.digitaloceanspaces.com/public/blog/20/how-to-force-eager-loading-and-prevent-n-1-issues-in-laravel.png"
                         alt="Learn how to force eager loading and prevent lazy loading in your Laravel application. You can use this feature to prevent N+1 queries to gain a performance improvement.">
                </figure>
            </div>
        </div>
    </div>
</div>

    <div class="blog-page-main-wrapper blog-post-container pt-5 mt-5 py-2">
        <div class="container">
            <div class="row justify-content-center full-width">
                <main class="col-lg-8 main-content">
                    <div class="author-box clearfix rounded-thumbnail">
        <form class="subscription-form">
            <div class="author-avatar">
                <i class="far fa-paper-plane"></i>
            </div>
            <div class="author-info">
                <div class="author-info-head">
                    <h3>Get your FREE copy of "<span class="pdf-name">The Clean Coder's Guide to Laravel</span>" and subscribe for future posts!</h3>
                </div>
                <div class="author-description">
                    <p class="mb-2 pt-2">
                        Join over 4000 developers who have already downloaded their copy!
                    </p>

                    <p class="mb-2">
                        Drop your email in the box below and you'll get notified every time a new post is published. You'll also get a FREE copy of my <strong>70 page</strong> PDF that shows you how you can make your Laravel projects cleaner.
                    </p>

                    <div class="row">
                        <div class="col-md">
                            <div class="form-group">
                                <input type="email" class="form-control" name="email" id="email" required placeholder="Your email address">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <button type="submit" class="btn fill-style">Subscribe</button>
                        </div>
                        <div class="col-md-12 error-box"></div>
                    </div>
                </div>
            </div>
        </form>
    </div>
                        <div class="blog-single-post blog-post" id="blog-post-content">
        <div class="post-info">
            <div class="post-des mt-0">

                
                <h2>Introduction</h2>
<p>In a past article, I talked about the performance improvements that you can achieve by using &quot;eager loading&quot; in your Laravel database queries. For anyone who hasn't read it, <a href="6-quick-and-easy-ways-to-speed-up-your-laravel-website">click here if you want to give it a quick read</a>.</p>
<h2>What is Eager Loading?</h2>
<p>When you are fetching any models from the database and then doing any type of processing on the modelâ€™s relations, itâ€™s important that you use <a href="https://laravel.com/docs/8.x/eloquent-relationships#eager-loading" target="_blank" rel="noopener noreferrer">eager loading</a>. Eager loading is super simple using Laravel and basically prevents you from encountering the N+1 problem with your data. This problem is caused by making N+1 queries to the database, where N is the number of items being fetched from the database. To explain this better and give it some context, let's check out the example below.</p>
<p>Imagine that you have two models (<code>Comment</code> and <code>Author</code>) with a one-to-one relationship between them. Now imagine that you have 100 comments and you want to loop through each one of them and output the authorâ€™s name.</p>
<p>Without eager loading, your code might look like this:</p>
<div class="code-block">
    <pre>
        <code data-theme="moonlight" data-lang="php" class="torchlight" style="background-color: #212539; --theme-selection-background: #aab3e5;"><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">1</span><span style="color: #7FDAFF;">$</span><span style="color: #E4F3FA;">comments </span><span style="color: #7FDAFF;">=</span><span style="color: #E4F3FA;"> </span><span style="color: #FFDB8E;">Comment</span><span style="color: #7FDAFF;">::</span><span style="color: #70B0FF;">all</span><span style="color: #7FDAFF;">();</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">2</span>&nbsp;</div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">3</span><span style="color: #BAACFF;">foreach</span><span style="color: #E4F3FA;"> </span><span style="color: #7FDAFF;">($</span><span style="color: #E4F3FA;">comments </span><span style="color: #BAACFF;">as</span><span style="color: #E4F3FA;"> </span><span style="color: #7FDAFF;">$</span><span style="color: #E4F3FA;">comment </span><span style="color: #7FDAFF;">)</span><span style="color: #E4F3FA;"> </span><span style="color: #7FDAFF;">{</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">4</span><span style="color: #E4F3FA;">    </span><span style="color: #34D3FB;">print_r</span><span style="color: #7FDAFF;">($</span><span style="color: #E4F3FA;">comment</span><span style="color: #7FDAFF;">-&gt;</span><span style="color: #A7C6E8;">author</span><span style="color: #7FDAFF;">-&gt;</span><span style="color: #A7C6E8;">name</span><span style="color: #7FDAFF;">);</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">5</span><span style="color: #7FDAFF;">}</span></div></code>    </pre>
</div>
<p>The code above would result in 101 database queries because it the results are &quot;lazy loaded&quot;! The first query would be to fetch all of the comments. The other one hundred queries would come from getting the authorâ€™s name in each iteration of the loop. Obviously, this can cause performance issues and slow down your application. So, how would we improve this?</p>
<p>By using eager loading, we could change the code to say:</p>
<div class="code-block">
    <pre>
        <code data-theme="moonlight" data-lang="php" class="torchlight" style="background-color: #212539; --theme-selection-background: #aab3e5;"><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">1</span><span style="color: #7FDAFF;">$</span><span style="color: #E4F3FA;">comments </span><span style="color: #7FDAFF;">=</span><span style="color: #E4F3FA;"> </span><span style="color: #FFDB8E;">Comment</span><span style="color: #7FDAFF;">::</span><span style="color: #70B0FF;">with</span><span style="color: #7FDAFF;">(</span><span style="color: #FFDF9B;">â€˜authorsâ€™</span><span style="color: #7FDAFF;">)-&gt;</span><span style="color: #70B0FF;">get</span><span style="color: #7FDAFF;">();</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">2</span>&nbsp;</div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">3</span><span style="color: #BAACFF;">foreach</span><span style="color: #E4F3FA;"> </span><span style="color: #7FDAFF;">($</span><span style="color: #E4F3FA;">comments </span><span style="color: #BAACFF;">as</span><span style="color: #E4F3FA;"> </span><span style="color: #7FDAFF;">$</span><span style="color: #E4F3FA;">comment </span><span style="color: #7FDAFF;">)</span><span style="color: #E4F3FA;"> </span><span style="color: #7FDAFF;">{</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">4</span><span style="color: #E4F3FA;">    </span><span style="color: #34D3FB;">print_r</span><span style="color: #7FDAFF;">($</span><span style="color: #E4F3FA;">comment</span><span style="color: #7FDAFF;">-&gt;</span><span style="color: #A7C6E8;">author</span><span style="color: #7FDAFF;">-&gt;</span><span style="color: #A7C6E8;">name</span><span style="color: #7FDAFF;">);</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">5</span><span style="color: #7FDAFF;">}</span></div></code>    </pre>
</div>
<p>As you can see, this code looks almost the same and is still readable. By adding the <code>::with('authors')</code> this will fetch all of the comments and then make another query to fetch the authors at once. So, this means that we will have cut down the query from <strong>101</strong> to <strong>2</strong>!</p>
<p>For more information, check out the Laravel documentation on <a href="https://laravel.com/docs/8.x/eloquent-relationships#eager-loading" target="_blank" rel="noopener noreferrer">eager loading</a>.</p>
<div class="blog-affiliate-one"></div>
<h2>How to Force Laravel to Use Eager Loading</h2>
<p>A <a href="https://github.com/laravel/framework/pull/37363" target="_blank" rel="noopener noreferrer">new feature</a> (added by <a href="https://github.com/themsaid" target="_blank" rel="noopener noreferrer">Mohamed Said</a>) has recently been merged into the Laravel codebase that allows you to prevent lazy loading taking place. This feature is incredibly useful because it should help to ensure that the relationships are eager loaded. As a result of this, it will likely help us to improve performance and reduce the amount of queries that are made to the database as shown in the example above.</p>
<p>It's super simple to prevent the lazy loading. All we need to do is add the following line to the <code>boot()</code> method of our <code>AppServiceProvider</code>:</p>
<div class="code-block">
    <pre>
        <code data-theme="moonlight" data-lang="php" class="torchlight" style="background-color: #212539; --theme-selection-background: #aab3e5;"><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">1</span><span style="color: #FFDB8E;">Model</span><span style="color: #7FDAFF;">::</span><span style="color: #70B0FF;">preventLazyLoading</span><span style="color: #7FDAFF;">();</span></div></code>    </pre>
</div>
<p>So, in our <code>AppServiceProvider</code>, it would look a bit like this:</p>
<div class="code-block">
    <pre>
        <code data-theme="moonlight" data-lang="php" class="torchlight" style="background-color: #212539; --theme-selection-background: #aab3e5;"><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 1</span><span style="color: #BAACFF;">namespace</span><span style="color: #E4F3FA;"> </span><span style="color: #FFDB8E;">App</span><span style="color: #7FDAFF;">\</span><span style="color: #FFDB8E;">Providers</span><span style="color: #7FDAFF;">;</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 2</span>&nbsp;</div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 3</span><span style="color: #BAACFF;">use</span><span style="color: #FFDB8E;"> Illuminate</span><span style="color: #7FDAFF;">\</span><span style="color: #FFDB8E;">Support</span><span style="color: #7FDAFF;">\</span><span style="color: #FFDB8E;">ServiceProvider</span><span style="color: #7FDAFF;">;</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 4</span>&nbsp;</div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 5</span><span style="color: #BAACFF;">class</span><span style="color: #E4F3FA;"> </span><span style="color: #FFDB8E;">AppServiceProvider</span><span style="color: #E4F3FA;"> </span><span style="color: #BAACFF;">extends</span><span style="color: #E4F3FA;"> </span><span style="color: #7AF8CA;">ServiceProvider</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 6</span><span style="color: #7FDAFF;">{</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 7</span><span style="color: #E4F3FA;">    </span><span style="color: #BAACFF;">public</span><span style="color: #E4F3FA;"> </span><span style="color: #BAACFF;">function</span><span style="color: #E4F3FA;"> </span><span style="color: #70B0FF;">boot</span><span style="color: #7FDAFF;">():</span><span style="color: #E4F3FA;"> </span><span style="color: #BAACFF;">void</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 8</span><span style="color: #E4F3FA;">    </span><span style="color: #7FDAFF;">{</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 9</span><span style="color: #7FDAFF;">        </span><span style="color: #7E8EDA;">// ...</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">10</span><span style="color: #E4F3FA;">        </span><span style="color: #FFDB8E;">Model</span><span style="color: #7FDAFF;">::</span><span style="color: #70B0FF;">preventLazyLoading</span><span style="color: #7FDAFF;">();</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">11</span><span style="color: #7FDAFF;">        </span><span style="color: #7E8EDA;">// ...</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">12</span><span style="color: #E4F3FA;">    </span><span style="color: #7FDAFF;">}</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">13</span><span style="color: #7FDAFF;">}</span></div></code>    </pre>
</div>
<h2>Allowing Eager Loading in Production Environments</h2>
<p>It's possible that you might only want to enable this feature when in your local development environment. By doing that, it can alert you to places in your code that's using lazy loading while building new features, but not completely crash your production website. For this very reason, the <code>preventLazyLoading()</code> method accepts a boolean as an argument, so we could use the following line:</p>
<div class="code-block">
    <pre>
        <code data-theme="moonlight" data-lang="php" class="torchlight" style="background-color: #212539; --theme-selection-background: #aab3e5;"><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">1</span><span style="color: #FFDB8E;">Model</span><span style="color: #7FDAFF;">::</span><span style="color: #70B0FF;">preventLazyLoading</span><span style="color: #7FDAFF;">(</span><span style="color: #BAACFF;">!</span><span style="color: #E4F3FA;"> </span><span style="color: #70B0FF;">app</span><span style="color: #7FDAFF;">()-&gt;</span><span style="color: #70B0FF;">isProduction</span><span style="color: #7FDAFF;">());</span></div></code>    </pre>
</div>
<p>So, in our <code>AppServiceProvider</code>, it could look like this:</p>
<div class="code-block">
    <pre>
        <code data-theme="moonlight" data-lang="php" class="torchlight" style="background-color: #212539; --theme-selection-background: #aab3e5;"><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 1</span><span style="color: #BAACFF;">namespace</span><span style="color: #E4F3FA;"> </span><span style="color: #FFDB8E;">App</span><span style="color: #7FDAFF;">\</span><span style="color: #FFDB8E;">Providers</span><span style="color: #7FDAFF;">;</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 2</span>&nbsp;</div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 3</span><span style="color: #BAACFF;">use</span><span style="color: #FFDB8E;"> Illuminate</span><span style="color: #7FDAFF;">\</span><span style="color: #FFDB8E;">Support</span><span style="color: #7FDAFF;">\</span><span style="color: #FFDB8E;">ServiceProvider</span><span style="color: #7FDAFF;">;</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 4</span>&nbsp;</div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 5</span><span style="color: #BAACFF;">class</span><span style="color: #E4F3FA;"> </span><span style="color: #FFDB8E;">AppServiceProvider</span><span style="color: #E4F3FA;"> </span><span style="color: #BAACFF;">extends</span><span style="color: #E4F3FA;"> </span><span style="color: #7AF8CA;">ServiceProvider</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 6</span><span style="color: #7FDAFF;">{</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 7</span><span style="color: #E4F3FA;">    </span><span style="color: #BAACFF;">public</span><span style="color: #E4F3FA;"> </span><span style="color: #BAACFF;">function</span><span style="color: #E4F3FA;"> </span><span style="color: #70B0FF;">boot</span><span style="color: #7FDAFF;">():</span><span style="color: #E4F3FA;"> </span><span style="color: #BAACFF;">void</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 8</span><span style="color: #E4F3FA;">    </span><span style="color: #7FDAFF;">{</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number"> 9</span><span style="color: #7FDAFF;">        </span><span style="color: #7E8EDA;">// ...</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">10</span><span style="color: #E4F3FA;">        </span><span style="color: #FFDB8E;">Model</span><span style="color: #7FDAFF;">::</span><span style="color: #70B0FF;">preventLazyLoading</span><span style="color: #7FDAFF;">(</span><span style="color: #BAACFF;">!</span><span style="color: #E4F3FA;"> </span><span style="color: #70B0FF;">app</span><span style="color: #7FDAFF;">()-&gt;</span><span style="color: #70B0FF;">isProduction</span><span style="color: #7FDAFF;">());</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">11</span><span style="color: #7FDAFF;">        </span><span style="color: #7E8EDA;">// ...</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">12</span><span style="color: #E4F3FA;">    </span><span style="color: #7FDAFF;">}</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">13</span><span style="color: #7FDAFF;">}</span></div></code>    </pre>
</div>
<p>By doing this, the feature will be disabled if your <code>APP_ENV</code> is <code>production</code> so that any lazy loading queries that slipped through don't cause exceptions to be thrown on your site.</p>
<h2>What Happens If We Try to Lazy Load?</h2>
<p>If we have the feature enabled in our service provider and we try to lazy load a relationship on a model, an <code>Illuminate\Database\LazyLoadingViolationException</code> exception will be thrown.</p>
<p>To give this a little bit of context, let's use our <code>Comment</code> and <code>Author</code> model examples from above. Let's say that we have the feature enabled.</p>
<p>The following snippet would throw an exception:</p>
<div class="code-block">
    <pre>
        <code data-theme="moonlight" data-lang="php" class="torchlight" style="background-color: #212539; --theme-selection-background: #aab3e5;"><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">1</span><span style="color: #7FDAFF;">$</span><span style="color: #E4F3FA;">comments </span><span style="color: #7FDAFF;">=</span><span style="color: #E4F3FA;"> </span><span style="color: #FFDB8E;">Comment</span><span style="color: #7FDAFF;">::</span><span style="color: #70B0FF;">all</span><span style="color: #7FDAFF;">();</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">2</span>&nbsp;</div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">3</span><span style="color: #BAACFF;">foreach</span><span style="color: #E4F3FA;"> </span><span style="color: #7FDAFF;">($</span><span style="color: #E4F3FA;">comments </span><span style="color: #BAACFF;">as</span><span style="color: #E4F3FA;"> </span><span style="color: #7FDAFF;">$</span><span style="color: #E4F3FA;">comment </span><span style="color: #7FDAFF;">)</span><span style="color: #E4F3FA;"> </span><span style="color: #7FDAFF;">{</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">4</span><span style="color: #E4F3FA;">    </span><span style="color: #34D3FB;">print_r</span><span style="color: #7FDAFF;">($</span><span style="color: #E4F3FA;">comment</span><span style="color: #7FDAFF;">-&gt;</span><span style="color: #A7C6E8;">author</span><span style="color: #7FDAFF;">-&gt;</span><span style="color: #A7C6E8;">name</span><span style="color: #7FDAFF;">);</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">5</span><span style="color: #7FDAFF;">}</span></div></code>    </pre>
</div>
<p>However, the following snippet would not throw an exception:</p>
<div class="code-block">
    <pre>
        <code data-theme="moonlight" data-lang="php" class="torchlight" style="background-color: #212539; --theme-selection-background: #aab3e5;"><!-- Syntax highlighted by torchlight.dev --><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">1</span><span style="color: #7FDAFF;">$</span><span style="color: #E4F3FA;">comments </span><span style="color: #7FDAFF;">=</span><span style="color: #E4F3FA;"> </span><span style="color: #FFDB8E;">Comment</span><span style="color: #7FDAFF;">::</span><span style="color: #70B0FF;">with</span><span style="color: #7FDAFF;">(</span><span style="color: #FFDF9B;">â€˜authorsâ€™</span><span style="color: #7FDAFF;">)-&gt;</span><span style="color: #70B0FF;">get</span><span style="color: #7FDAFF;">();</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">2</span>&nbsp;</div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">3</span><span style="color: #BAACFF;">foreach</span><span style="color: #E4F3FA;"> </span><span style="color: #7FDAFF;">($</span><span style="color: #E4F3FA;">comments </span><span style="color: #BAACFF;">as</span><span style="color: #E4F3FA;"> </span><span style="color: #7FDAFF;">$</span><span style="color: #E4F3FA;">comment </span><span style="color: #7FDAFF;">)</span><span style="color: #E4F3FA;"> </span><span style="color: #7FDAFF;">{</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">4</span><span style="color: #E4F3FA;">    </span><span style="color: #34D3FB;">print_r</span><span style="color: #7FDAFF;">($</span><span style="color: #E4F3FA;">comment</span><span style="color: #7FDAFF;">-&gt;</span><span style="color: #A7C6E8;">author</span><span style="color: #7FDAFF;">-&gt;</span><span style="color: #A7C6E8;">name</span><span style="color: #7FDAFF;">);</span></div><div class='line'><span style="color:#5b6395; text-align: right; -webkit-user-select: none; user-select: none;" class="line-number">5</span><span style="color: #7FDAFF;">}</span></div></code>    </pre>
</div>
<h2>Conclusion</h2>
<p>In my personal opinion, I think this feature is going to be really useful and it will likely help to encourage better model and database query practices. I have a feeling that this is going to be a feature that I use a daily basis and will likely think &quot;<em>How did I use to survive without this?</em>&quot;.</p>
<p>I'm hoping that you found this short post useful though. If it's the type of thing that you're interested in hearing more about, feel free to sign up to my newsletter below. You'll get an notified each time that I post a new article about the Laravel world! ðŸš€</p>

            </div>
        </div>
    </div>
                    <div class="author-box clearfix rounded-thumbnail">
        <form class="subscription-form">
            <div class="author-avatar">
                <i class="far fa-paper-plane"></i>
            </div>
            <div class="author-info">
                <div class="author-info-head">
                    <h3>Get your FREE copy of "<span class="pdf-name">The Clean Coder's Guide to Laravel</span>" and subscribe for future posts!</h3>
                </div>
                <div class="author-description">
                    <p class="mb-2 pt-2">
                        Join over 4000 developers who have already downloaded their copy!
                    </p>

                    <p class="mb-2">
                        Drop your email in the box below and you'll get notified every time a new post is published. You'll also get a FREE copy of my <strong>70 page</strong> PDF that shows you how you can make your Laravel projects cleaner.
                    </p>

                    <div class="row">
                        <div class="col-md">
                            <div class="form-group">
                                <input type="email" class="form-control" name="email" id="email" required placeholder="Your email address">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <button type="submit" class="btn fill-style">Subscribe</button>
                        </div>
                        <div class="col-md-12 error-box"></div>
                    </div>
                </div>
            </div>
        </form>
    </div>

                    <hr>
                    <p class="font-italic mb-2">Blog post banner image by <a href="https://jesspickup.co.uk">Jess Pickup</a>.</p>

                    
                    <div class="text-center">
    <hr>

    <div class="row py-3">
        <div class="col-lg text-left">
                            <a href="5-lessons-i-learned-from-building-my-own-laravel-package" class="prev-next-container row align-items-center">
                    <div class="col-2">
                        <i class="fas fa-chevron-left prev-next-button"></i>
                    </div>
                    <div class="col">
                        <strong>Previous article:</strong><br>
                        5 Lessons I Learned from Building My Own Laravel Package
                    </div>
                </a>
                    </div>
        <div class="col-lg text-right pt-4 py-lg-0">
                            <a href="using-interfaces-to-write-better-php-code" class="prev-next-container row align-items-center">
                    <div class="col">
                        <strong>Next article:</strong><br>
                        Using Interfaces to Write Better PHP Code
                    </div>
                    <div class="col-2">
                        <i class="fas fa-chevron-right prev-next-button"></i>
                    </div>
                </a>
                    </div>
    </div>
</div>
                    <hr>
                    <div class="share-buttons text-center">
    <h5><strong>Share!</strong></h5>

    <!-- Email -->
    <div class="p-1 share-button-container">
        <a href="mailto:?Subject=Sharing this blog post from Ash Allen Design!&Body=I am sharing this blog post from Ash Allen Design!https://ashallendesign.co.uk/blog/how-to-force-eager-loading-and-prevent-n-1-issues-in-laravel">
            <img src="https://simplesharebuttons.com/images/somacro/email.png"
                 alt="Share website design email to Email"/>
        </a>
    </div>

    <!-- Facebook -->
    <div class="p-1 share-button-container">
        <a href="http://www.facebook.com/sharer.php?u=https://ashallendesign.co.uk/blog/how-to-force-eager-loading-and-prevent-n-1-issues-in-laravel" target="_blank" rel="noopener noreferrer">
            <img src="https://simplesharebuttons.com/images/somacro/facebook.png"
                 alt="Share website design email to Facebook"/>
        </a>
    </div>


    <!-- LinkedIn -->
    <div class="p-1 share-button-container">
        <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://ashallendesign.co.uk/blog/how-to-force-eager-loading-and-prevent-n-1-issues-in-laravel"
           target="_blank" rel="noopener noreferrer">
            <img src="https://simplesharebuttons.com/images/somacro/linkedin.png"
                 alt="Share website design email to LinkedIn"/>
        </a>
    </div>

    <!-- Print -->
    <div class="p-1 share-button-container">
        <a href="javascript:;" onclick="window.print()">
            <img src="https://simplesharebuttons.com/images/somacro/print.png"
                 alt="Share website design email to Print"/>
        </a>
    </div>

    <!-- Reddit -->
    <div class="p-1 share-button-container">
        <a href="http://reddit.com/submit?url=https://ashallendesign.co.uk/blog/how-to-force-eager-loading-and-prevent-n-1-issues-in-laravel&amp;title=How to Force Eager Loading and Prevent N+1 Issues in Laravel"
           target="_blank" rel="noopener noreferrer">
            <img src="https://simplesharebuttons.com/images/somacro/reddit.png"
                 alt="Share website design email to Reddit"/>
        </a>
    </div>

    <!-- Tumblr-->
    <div class="p-1 share-button-container">
        <a href="http://www.tumblr.com/share/link?url=https://ashallendesign.co.uk/blog/how-to-force-eager-loading-and-prevent-n-1-issues-in-laravel&amp;title=Simple Share Buttons"
           target="_blank" rel="noopener noreferrer">
            <img src="https://simplesharebuttons.com/images/somacro/tumblr.png"
                 alt="Share website design email to Tumblr"/>
        </a>
    </div>

    <!-- Twitter -->
    <div class="p-1 share-button-container">
        <a href="https://twitter.com/share?url=https://ashallendesign.co.uk/blog/how-to-force-eager-loading-and-prevent-n-1-issues-in-laravel&amp;text=How to Force Eager Loading and Prevent N+1 Issues in Laravel&amp;hashtags=ashallendesign,webdesign"
           target="_blank" rel="noopener noreferrer">
            <img src="https://simplesharebuttons.com/images/somacro/twitter.png"
                 alt="Share website design email to Twitter"/>
        </a>
    </div>
</div>

                    <div class="mt-5" id="disqus_thread"></div>
                </main>

                <aside class="col-lg-3 offset-lg-1">
                    <div class="widget widget-tags">
    <div class="row align-items-center">
        <div class="col-3">
            <img src="../images/custom/AshleyAllen-Blog.png?v=1"
                 alt="Ashley Allen - Freelance web developer"
                 class="blog-author-image mr-2 shadow">
        </div>
        <div class="col-lg-6">
            <p class="side-bar-author my-auto mb-0">Ashley Allen</p>
        </div>
        <div class="col-12 widget-title"></div>
    </div>
    <div class="row mb-5">
        <p class="col-12 text-muted font-size-regular">
            I'm a freelance Laravel web developer who loves contributing to open-source projects and building exciting systems to help businesses succeed.
            <br>
        </p>
        <div class="col-12">
            <iframe src="https://github.com/sponsors/ash-jc-allen/button"
        title="Sponsor ash-jc-allen"
        height="35"
        width="116"
        style="border: 0;">
</iframe>
        </div>
    </div>

    <h3 class="widget-title">Related</h3>
    <div class="mb-5 pb-1">
                    <div class="blog-post mb-4">
                <div class="post-thumb shadow mb-3">
                    <a href="what-s-new-in-laravel-config-validator-v2-0-0-and-v2-1-0" class="d-block rounded-thumbnail shadow">
                        <img data-src="https://ashallendesign.ams3.digitaloceanspaces.com/public/blog/82/whats-new-in-laravel-config-validator-v200-and-v210_small.png"
                             alt="What&#039;s New in Laravel Config Validator v2.0.0 &amp; v2.1.0"
                             class="rounded-thumbnail lazyload">
                    </a>
                </div>
                <div class="post-info">
                    <h4 class="related-post-title">
                        <a href="what-s-new-in-laravel-config-validator-v2-0-0-and-v2-1-0">
                            What&#039;s New in Laravel Config Validator v2.0.0 &amp; v2.1.0
                        </a>
                    </h4>

                    <img data-src="/images/custom/AshleyAllen-Blog.png?v=1" alt="Ashley Allen - Freelance web developer"
                         class="blog-author-image-smaller mr-2 shadow-sm lazyload">
                    <span class="meta-author">Ashley Allen</span>
                </div>
            </div>
                    <div class="blog-post mb-4">
                <div class="post-thumb shadow mb-3">
                    <a href="round-up-march-2022" class="d-block rounded-thumbnail shadow">
                        <img data-src="https://ashallendesign.ams3.digitaloceanspaces.com/public/blog/81/round-up-march-2022_small.png"
                             alt="Round Up: March 2022"
                             class="rounded-thumbnail lazyload">
                    </a>
                </div>
                <div class="post-info">
                    <h4 class="related-post-title">
                        <a href="round-up-march-2022">
                            Round Up: March 2022
                        </a>
                    </h4>

                    <img data-src="/images/custom/AshleyAllen-Blog.png?v=1" alt="Ashley Allen - Freelance web developer"
                         class="blog-author-image-smaller mr-2 shadow-sm lazyload">
                    <span class="meta-author">Ashley Allen</span>
                </div>
            </div>
                    <div class="blog-post mb-4">
                <div class="post-thumb shadow mb-3">
                    <a href="using-query-in-laravel-eloquent-queries" class="d-block rounded-thumbnail shadow">
                        <img data-src="https://ashallendesign.ams3.digitaloceanspaces.com/public/blog/79/Using query in Laravel Eloquent Queries_small.png"
                             alt="Using &#039;query()&#039; in Laravel Eloquent Queries"
                             class="rounded-thumbnail lazyload">
                    </a>
                </div>
                <div class="post-info">
                    <h4 class="related-post-title">
                        <a href="using-query-in-laravel-eloquent-queries">
                            Using &#039;query()&#039; in Laravel Eloquent Queries
                        </a>
                    </h4>

                    <img data-src="/images/custom/AshleyAllen-Blog.png?v=1" alt="Ashley Allen - Freelance web developer"
                         class="blog-author-image-smaller mr-2 shadow-sm lazyload">
                    <span class="meta-author">Ashley Allen</span>
                </div>
            </div>
            </div>

    <h3 class="widget-title pb-4"></h3>
    <div>
        <div class="author-box clearfix sponsor-section ml-0">
    <div class="author-info">
        <div class="author-info-head">
            <h3>Sponsor Me! ðŸš€</h3>
        </div>
        <div class="author-description">
            <p class="mb-3 pt-2 font-size-regular">
                Help support the blog so that I can continue creating new content!
            </p>

            <iframe src="https://github.com/sponsors/ash-jc-allen/button"
        title="Sponsor ash-jc-allen"
        height="35"
        width="116"
        style="border: 0;">
</iframe>
        </div>
    </div>
</div>

        <h3 class="widget-title pb-4"></h3>

        <div class="blog-post mb-4">
            <div class="post-thumb shadow mb-3">
                <a href="https://www.digitalocean.com/?refcode=7d06055e9d46&utm_campaign=Referral_Invite&utm_medium=Referral_Program&utm_source=badge"
                   class="d-block rounded-thumbnail shadow"
                   target="_blank"
                   rel="noreferrer noopener"
                >
                    <img data-src="/images/custom/sponsors/digital-ocean-free-credit.png"
                         alt="DigitalOcean Referral Badge"
                         class="rounded-thumbnail lazyload">
                </a>
            </div>
        </div>

        <div class="blog-post mb-4">
            <div class="post-thumb shadow mb-3">
                <a href="https://usefathom.com/ref/IYEWUV"
                   class="d-block rounded-thumbnail shadow"
                   target="_blank"
                   rel="noreferrer noopener"
                >
                    <img data-src="/images/custom/sponsors/fathom-vertical.png"
                         alt="Fathom Analytics"
                         class="rounded-thumbnail lazyload">
                </a>
            </div>
        </div>
    </div>
</div>
                </aside>
            </div>
        </div>
    </div>

<footer class="footer">
    <div class="animated-waves">
        <svg width="100%" height="100%" version="1.1" xmlns="http://www.w3.org/2000/svg" class="animated-wave">
            <defs></defs>
            <path id="animated-wave-one" d=""/>
        </svg>
        <svg width="100%" height="100%" version="1.1" xmlns="http://www.w3.org/2000/svg" class="animated-wave">
            <defs></defs>
            <path id="animated-wave-two" d=""/>
        </svg>
        <svg width="100%" height="100%" version="1.1" xmlns="http://www.w3.org/2000/svg" class="animated-wave">
            <defs></defs>
            <path id="animated-wave-three" d=""/>
        </svg>
        <svg width="100%" height="100%" version="1.1" xmlns="http://www.w3.org/2000/svg" class="animated-wave">
            <defs></defs>
            <path id="animated-wave-four" d=""/>
        </svg>
    </div>
    <div class="f-widget-area">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-sm-6">
                    <div class="f-widget">
                        <div class="f-logo">
                            <img src="../images/custom/logo-colour-side.png" alt="Ash Allen Design logo in colour">
                        </div>
                        <p>A passionate freelance web developer based in Preston, Lancashire, UK. </p>
                        <div class="footer-social-media">
                            <ul class="social-profile">
                                <li>
                                    <a href="https://www.facebook.com/ashallendesignuk/" class="p-2" target="_blank" rel="noopener noreferrer">
                                        <i class="social_facebook"></i>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://linkedin.com/company/ash-allen-design" class="p-2" target="_blank" rel="noopener noreferrer">
                                        <i class="social_linkedin"></i>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://github.com/ash-jc-allen" class="p-2" target="_blank" rel="noopener noreferrer">
                                        <i class="fab fa-github"></i>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://www.instagram.com/ashallendesign_uk/" class="p-2" target="_blank" rel="noopener noreferrer">
                                        <i class="social_instagram"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>

                        <a href="https://www.digitalocean.com/?refcode=7d06055e9d46&utm_campaign=Referral_Invite&utm_medium=Referral_Program&utm_source=badge">
                            <img data-src="/images/custom/sponsors/digital-ocean-white.svg" alt="DigitalOcean Referral Badge" class="lazyload"/>
                        </a>

                        <div class="mt-3">
                            <iframe src="https://github.com/sponsors/ash-jc-allen/button"
        title="Sponsor ash-jc-allen"
        height="35"
        width="116"
        style="border: 0;">
</iframe>
                        </div>
                    </div>
                </div>
                <div class="col-lg-8 offset-lg-1">
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="f-widget">
                                <h3 class="f-widget-title">Services</h3>
                                <ul class="f-list">
                                    <li><a href="../services/website-design">Website Design</a></li>
                                    <li><a href="../services/laravel-web-development">Laravel Web Development</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="f-widget">
                                <h3 class="f-widget-title">About Me</h3>
                                <ul class="f-list">
                                    <li><a href="../portfolio">Portfolio</a></li>
                                    <li><a href="../blog">Blog</a></li>
                                    <li><a href="../contact">Contact</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-4">
                    <div class="f-widget">
                        <h3 class="f-widget-title">Contact Info</h3>
                        <ul class="f-contact-list">
                            <li><span>Office:</span> Preston, Lancashire, UK</li>
                            <li><span>Call Me:</span> 07963 116038</li>
                            <li><span>Email Me:</span> mail@ashallendesign.co.uk</li>
                        </ul>
                    </div>
                </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="f-copyright-area">
        <div class="container">
            <div class="row align-items-center justify-content-center">
                <div class="col-md-6">
                    <p class="copyright text-center text-md-left mb-2 mb-md-0">
                        Â© 2022 <a href="../index.html">Ash Allen Design</a> ALL RIGHTS RESERVED
                    </p>
                </div>
                <div class="col-md-6 text-right">
                    <p class="copyright text-center text-md-left mb-2 mb-md-0 d-inline-block mr-2">
                        <a href="../privacy-policy" class="dark-link">Privacy Policy</a>
                    </p>
                    <p class="copyright text-center text-md-left mb-2 mb-md-0 d-inline-block mr-2">
                        <a href="../terms-of-service" class="dark-link">Terms of Service</a>
                    </p>
                    <p class="copyright text-center text-md-left mb-2 mb-md-0 d-inline-block">
                        <a href="../sitemap" class="dark-link">Sitemap</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</footer><!-- footer -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>

    <script>
        var disqus_config = function () {
            this.page.url = "https://ashallendesign.co.uk/blog/how-to-force-eager-loading-and-prevent-n-1-issues-in-laravel";
            this.page.identifier = "how-to-force-eager-loading-and-prevent-n-1-issues-in-laravel";
            this.page.title = "How to Force Eager Loading and Prevent N+1 Issues in Laravel";
        };
    </script>
</body>
</html>
